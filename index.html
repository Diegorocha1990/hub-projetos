<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Eficiência Pro - Unico</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Nunito+Sans:wght@300;400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary-color: #000a28; --accent-color: #00e5ff; --bg-body: #f4f7f9; }
        body { font-family: 'Nunito Sans', sans-serif; background-color: var(--bg-body); color: var(--primary-color); }
        .input-premium { background-color: #ffffff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 0.75rem 1rem; transition: all 0.2s; outline: none; font-weight: 700; width: 100%; }
        .input-premium:focus { border-color: var(--accent-color); box-shadow: 0 0 0 4px rgba(0, 229, 255, 0.1); }
        .label-forte { font-size: 0.7rem; font-weight: 900; text-transform: uppercase; letter-spacing: 0.05em; color: #475569; margin-bottom: 0.5rem; display: block; }
        .active-tab { color: var(--accent-color); border-bottom: 4px solid var(--accent-color); font-weight: 900; }
        .card-project { background: white; border-radius: 32px; border: 1px solid #e2e8f0; transition: all 0.3s ease; }
        .kpi-card { background: white; padding: 1.25rem; border-radius: 1.5rem; border: 1px solid #f1f5f9; display: flex; flex-direction: column; justify-content: center; }
        #loading-overlay { position: fixed; inset: 0; background: var(--primary-color); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; color: white; transition: opacity 0.5s; }
        .tooltip-container { position: relative; display: inline-block; cursor: help; color: #00e5ff; font-weight: bold; }
        .tooltip-text { visibility: hidden; width: 220px; background-color: #334155; color: #fff; text-align: center; border-radius: 8px; padding: 10px; position: absolute; z-index: 100; bottom: 125%; left: 50%; margin-left: -110px; opacity: 0; transition: opacity 0.3s; font-size: 10px; text-transform: none; line-height: 1.4; }
        .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <img src="https://cloudfilesdm.com/postcards/unico-color__1-878cebbc.png" class="w-32 mb-8 invert" alt="Unico">
        <div class="w-10 h-10 border-4 border-slate-700 border-t-cyan-400 rounded-full animate-spin"></div>
    </div>

    <header class="bg-white border-b border-slate-100 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-20 flex justify-between items-center">
            <div class="flex items-center gap-6">
                <img src="https://cloudfilesdm.com/postcards/unico-color__1-878cebbc.png" class="h-8" alt="Unico Logo">
                <div id="sync-indicator" class="hidden md:flex items-center gap-2 px-3 py-1 bg-green-50 rounded-full border border-green-100">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    <span class="text-[10px] font-black text-green-600 uppercase">Tempo Real</span>
                </div>
            </div>
            <nav class="flex gap-8 h-full items-center text-[11px] font-black uppercase tracking-widest text-slate-400">
                <button onclick="switchTab('dashboard')" id="tab-dashboard" class="h-full px-2 active-tab">Dashboard</button>
                <button onclick="switchTab('form')" id="tab-form" class="h-full px-2">Novo Projeto</button>
                <button onclick="switchTab('list')" id="tab-list" class="h-full px-2">Lista Geral</button>
            </nav>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-6 mt-4">
        <div id="view-dashboard" class="block">
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3 mb-10">
                <div class="kpi-card border-l-4 border-slate-900"><p class="label-forte">Total</p><h2 id="kpi-total" class="text-2xl font-black">0</h2></div>
                <div class="kpi-card border-l-4 border-cyan-400"><p class="label-forte text-cyan-600">SLA</p><h2 id="kpi-sla" class="text-2xl font-black text-cyan-600">0%</h2></div>
                <div class="kpi-card border-l-4 border-green-500"><p class="label-forte text-green-600">No Prazo</p><h2 id="kpi-concluidos-prazo" class="text-2xl font-black text-green-600">0</h2></div>
                <div class="kpi-card border-l-4 border-red-500"><p class="label-forte text-red-600">Atraso</p><h2 id="kpi-concluidos-atraso" class="text-2xl font-black text-red-600">0</h2></div>
                <div class="kpi-card border-l-4 border-amber-400"><p class="label-forte text-amber-500">Bloqueios</p><h2 id="kpi-blockers" class="text-2xl font-black text-amber-600">0</h2></div>
                <div class="kpi-card border-l-4 border-pink-500"><p class="label-forte text-pink-600">Alta Prior.</p><h2 id="kpi-prioridade" class="text-2xl font-black text-pink-600">0</h2></div>
                <div class="kpi-card border-l-4 border-indigo-500"><p class="label-forte text-indigo-600">Saúde</p><h2 id="kpi-saude" class="text-2xl font-black text-indigo-600">0%</h2></div>
            </div>
            <div id="projects-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>
        </div>

        <div id="view-form" class="hidden">
            <div class="bg-white p-10 rounded-[2.5rem] shadow-2xl border-t-[12px] border-cyan-400">
                <form id="project-form" class="space-y-8">
                    <input type="hidden" id="edit-id" value="">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="md:col-span-2">
                            <label class="label-forte">Nome da Iniciativa</label>
                            <input type="text" id="iniciativa" required class="input-premium uppercase" placeholder="Nome do Projeto">
                        </div>
                        <div>
                            <label class="label-forte">Prioridade</label>
                            <select id="prioridade" class="input-premium">
                                <option value="Baixa">Baixa</option>
                                <option value="Média">Média</option>
                                <option value="Alta">Alta</option>
                            </select>
                        </div>
                        <div>
                            <label class="label-forte flex items-center gap-2">
                                Tamanho do Esforço
                                <span class="tooltip-container">ⓘ
                                    <span class="tooltip-text">RÁPIDO: Execução individual.<br>INTERMEDIÁRIO: Envolve mais áreas.<br>ESTRUTURANTE: Alta complexidade.</span>
                                </span>
                            </label>
                            <select id="esforco" required class="input-premium">
                                <option value="Rápido">Rápido</option>
                                <option value="Intermediário">Intermediário</option>
                                <option value="Estruturante">Estruturante</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div><label class="label-forte">Área</label><select id="time" class="input-premium" required></select></div>
                        <div><label class="label-forte">Frente</label><select id="frente" class="input-premium" required></select></div>
                        <div><label class="label-forte">Status Atual</label><select id="status" class="input-premium font-black"><option value="Backlog">Backlog</option><option value="Em Andamento">Em Andamento</option><option value="Finalizado">Finalizado</option></select></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100">
                            <label class="label-forte">Datas</label>
                            <div class="grid grid-cols-2 gap-4">
                                <div><label class="text-[9px] font-black uppercase text-slate-400">Início</label><input type="date" id="data_criacao" class="input-premium"></div>
                                <div><label class="text-[9px] font-black uppercase text-slate-400">Target</label><input type="date" id="prazo" class="input-premium"></div>
                            </div>
                        </div>
                        <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100">
                            <label class="label-forte">Responsáveis</label>
                            <div id="responsaveis-grid" class="grid grid-cols-2 gap-2 max-h-32 overflow-y-auto pr-2"></div>
                        </div>
                    </div>
                    <div class="flex gap-4 pt-10 border-t">
                        <button type="submit" id="btn-submit" class="bg-slate-900 text-white px-10 py-5 rounded-2xl font-black uppercase text-xs tracking-widest flex-1">Salvar Iniciativa</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // CONFIGURAÇÃO AUTOMÁTICA PELO GEMINI
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'hub-unico-2026';

        let projects = [];
        const defaultTeam = ["Cauan Pereira Da Silva", "Diego Francisco Rocha", "Hudson Nestor Pereira Cortes", "Lucas Henrique Jantsch", "Luiz Gustavo Ribeiro", "Michael Gabriel Moraes Faria", "Otávio Augusto Oliveira", "Rodrigo Prinz De Paiva", "Simone Thomé de Andrade"];
        const defaultAreas = ["Análise", "CX", "Dados", "Processos", "Planejamento", "Comunicação"];
        const defaultFrentes = ["Performance", "Reestruturação", "Automação", "Simplificação"];

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('sync-indicator').classList.remove('hidden');
                setupLists();
                setupRealtime();
            }
        });

        const setupLists = () => {
            document.getElementById('time').innerHTML = defaultAreas.map(a => `<option value="${a}">${a}</option>`).join('');
            document.getElementById('frente').innerHTML = defaultFrentes.map(f => `<option value="${f}">${f}</option>`).join('');
            document.getElementById('responsaveis-grid').innerHTML = defaultTeam.map(n => `<label class="flex items-center gap-2 text-[10px] font-bold"><input type="checkbox" name="resp" value="${n}"> ${n}</label>`).join('');
        };

        const setupRealtime = () => {
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'projects'), (snap) => {
                projects = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                document.getElementById('loading-overlay').style.opacity = '0';
                setTimeout(() => document.getElementById('loading-overlay').style.display = 'none', 500);
                refreshUI();
            });
        };

        window.refreshUI = () => {
            const grid = document.getElementById('projects-grid');
            if(!grid) return;
            grid.innerHTML = projects.map(p => `
                <div class="card-project p-8 border-t-[10px]" style="border-top-color: ${p.prioridade === 'Alta' ? '#fb7185' : '#00e5ff'}">
                    <span class="text-[9px] font-black uppercase text-slate-300">${p.time} | ${p.esforco}</span>
                    <h3 class="text-lg font-black mt-2 uppercase">${p.iniciativa}</h3>
                    <div class="mt-8 flex justify-between items-center">
                        <span class="status-pill status-${p.status?.toLowerCase().replace(/\s/g, '')}">${p.status}</span>
                        <button onclick="editProjectByID('${p.id}')" class="text-cyan-500 font-black text-[10px] hover:underline">ABRIR</button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('kpi-total').innerText = projects.length;
            document.getElementById('kpi-prioridade').innerText = projects.filter(p => p.prioridade === 'Alta').length;
        };

        document.getElementById('project-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const editId = document.getElementById('edit-id').value;
            const data = {
                iniciativa: document.getElementById('iniciativa').value.toUpperCase(),
                prioridade: document.getElementById('prioridade').value,
                esforco: document.getElementById('esforco').value,
                time: document.getElementById('time').value,
                frente: document.getElementById('frente').value,
                status: document.getElementById('status').value,
                data_criacao: document.getElementById('data_criacao').value,
                prazo: document.getElementById('prazo').value,
                responsavel: Array.from(document.querySelectorAll('input[name="resp"]:checked')).map(c => c.value)
            };
            if(editId) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'projects', editId), data);
            else await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'projects'), data);
            switchTab('dashboard');
        });

        window.switchTab = (t) => {
            document.getElementById('view-dashboard').classList.toggle('hidden', t !== 'dashboard');
            document.getElementById('view-form').classList.toggle('hidden', t !== 'form');
            if(t === 'form' && !document.getElementById('edit-id').value) document.getElementById('project-form').reset();
        };

        window.editProjectByID = (id) => {
            const p = projects.find(x => x.id === id);
            if(p) {
                document.getElementById('edit-id').value = p.id;
                document.getElementById('iniciativa').value = p.iniciativa;
                document.getElementById('prioridade').value = p.prioridade;
                document.getElementById('esforco').value = p.esforco || "Rápido";
                document.getElementById('time').value = p.time;
                document.getElementById('frente').value = p.frente;
                document.getElementById('status').value = p.status;
                document.querySelectorAll('input[name="resp"]').forEach(cb => cb.checked = p.responsavel?.includes(cb.value));
                switchTab('form');
            }
        };

        signInAnonymously(auth).catch(err => console.error("Auth Failed", err));
    </script>
</body>
</html>
